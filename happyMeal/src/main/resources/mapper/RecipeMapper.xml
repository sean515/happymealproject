<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.meal.happy.dao.RecipeDAO">
      
      <select id="recipeTotalRecord" resultType="int">
		select count(b.recipe_no) totalRecord from recipe b join member r on b.userid=r.userid
		<if test="searchWord!=null">
			where ${searchKey} like '%${searchWord}%'
		</if>
	  </select>
	  
	  <select id="pageSelect" resultType="com.meal.happy.dto.RecipeDTO">
		select * from
			(select * from
				(
					select b.recipe_no, b.recipe_name, b.userid, r.username, b.recipe_hit, to_char(b.recipe_date,'MM-DD HH:MI') recipe_date 
					from recipe b join member r on b.userid=r.userid 
					<if test="searchWord!=null"><!-- 검색어가 있을 경우 -->
						and ${searchKey} like '%${searchWord}%'  
					</if>
					
					order by b.recipe_no desc
				) 
				
				<![CDATA[
				where rownum<=${onePageRecord*nowPage} order by recipe_no asc	
				]]>
				)
				<choose>
					<when test="nowPage!=totalPage">
					<![CDATA[
					where rownum <=${onePageRecord} order by recipe_no desc
					]]>
					</when>
					<when test="nowPage==totalPage">
					<![CDATA[
					where rownum <=${lastPageRecord} order by recipe_no desc
					]]>	
					</when>
				</choose>
	</select>
      
        
  </mapper>